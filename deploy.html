<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Security-Policy" content="default-src 'self' http: https: ws: wss: 'unsafe-inline';">
</head>
<body>
<style name="assets/fonts.css" type="text/css">/* inter-regular - latin */
@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-weight: 400;
  src: url('assets/fonts/inter-v8-latin-regular.eot'); /* IE9 Compat Modes */
  src: local(''),
       url('assets/fonts/inter-v8-latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('assets/fonts/inter-v8-latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
       url('assets/fonts/inter-v8-latin-regular.woff') format('woff'), /* Modern Browsers */
       url('assets/fonts/inter-v8-latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
       url('assets/fonts/inter-v8-latin-regular.svg#Inter') format('svg'); /* Legacy iOS */
}

/* inter-600 - latin */
@font-face {
  font-family: 'Inter';
  font-style: normal;
  font-weight: 600;
  src: url('assets/fonts/inter-v8-latin-600.eot'); /* IE9 Compat Modes */
  src: local(''),
       url('assets/fonts/inter-v8-latin-600.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('assets/fonts/inter-v8-latin-600.woff2') format('woff2'), /* Super Modern Browsers */
       url('assets/fonts/inter-v8-latin-600.woff') format('woff'), /* Modern Browsers */
       url('assets/fonts/inter-v8-latin-600.ttf') format('truetype'), /* Safari, Android, iOS */
       url('assets/fonts/inter-v8-latin-600.svg#Inter') format('svg'); /* Legacy iOS */
}


</style>
<style name="assets/style.css" type="text/css">* { box-sizing: border-box; margin: 0; padding: 0; line-height: 1.5; }

body { color: #123; font-size: 16px; font-family: "Inter", sans-serif; }
body { background-color: #f0f0f0; background-image: url('assets/bg.svg'); background-repeat: repeat; }

body > header {
  text-align: center;
  max-width: 80rem;
  margin: 0 auto;
  padding: 2rem 2rem 1rem;
}
body > header { display: flex; flex-flow: row nowrap; justify-content: space-around; align-items: center; }
body > header .logo, .logo img { display: block; margin: 0; flex-shrink: 1; }
body > header .logo img { max-width: 16rem; max-height: 16rem; }
body > header .badges { margin-bottom: 1rem; }
body > header a.badge { display: inline-block; padding: 0.25rem 0.5rem; }

section { padding: 1em; }

footer { padding: 1em; }

a { text-decoration: none; }
a:hover { text-decoration: underline; }
a, a:focus, a:visited, a:active, a:hover { color: rgb(101, 179, 76) }

h1, h2, h3, h4 { font-weight: 600 }
h1 { font-size: 3em;     line-height: 3rem;   margin-bottom: 2rem;                     }
h2 { font-size: 1.75em;  line-height: 2rem;   margin-bottom: 1rem;   margin-top: 0;    }
h3 { font-size: 1.5rem;  line-height: 2rem;   margin-bottom: 1rem;                     }
h4 { font-size: 1.25em;  line-height: 1.5rem; margin-bottom: 0.5rem; margin-top: 2rem; }
h5 { font-size: 1.125em; line-height: 1.5rem; margin-bottom: 0.5rem; margin-top: 2rem; }

button, .button {
  display: inline-block;
  background: rgb(101, 179, 76);
  color: white;
  padding: 0 1em;
  margin: 1em 0;
  text-shadow: -1px -1px 0 black;
  box-shadow: 1px 1px 0 black;
}
a.button:focus, a.button:visited, a.button:active, a.button:hover {
  color: white;
}

th, td { text-align: left; vertical-align: top; }
th { padding-right: 5em }

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  flex-flow: row wrap;
  justify-content: center;
  max-width: 80rem;
  margin: 0 auto 3rem;
}

@media (max-width: 80rem) {
  .grid {
    display: flex;
    flex-flow: column nowrap;
  }
  .grid .feature {
    display: flex;
    flex-flow: row nowrap;
  }
  .grid .feature .links {
    flex-shrink: 0;
    width: 33%;
    margin: 0 0 0 2rem;
  }
  .table-of-contents {
    width: 1rem;
  }
}

@media (max-width: 48rem) {
  .grid .feature .links {
    width: 50%;
  }
}

.big-left { grid-column-start: 1; grid-column-end: 3; }
.big-center { grid-column-start: 2; grid-column-end: 4; }
.big-right { grid-column-start: 3; grid-column-end: 5; }
.big-all { grid-column-start: 1; grid-column-end: 5; }

.feature {
  padding: 1rem;
  margin: 1rem 0.5rem 0;
  border: 1px solid rgba(0,0,0,0.1);
  border-top-color: rgba(255,255,255,0.5);
  border-left-color: rgba(255,255,255,0.5);
  border-radius: 3px;
  box-shadow: 3px 3px 6px rgba(0,0,0,0.1);
  display: flex;
  flex-flow: column nowrap;
  background: #fff;
}

.feature .docs {
  font-weight: bold;
}

#features .feature {
  min-height: 10rem;
}

.left {
  text-align: left;
}
.center {
  text-align: center;
}

.feature .description {
  line-height: 1.5;
  font-size: 0.875rem;
}

code { font-size: 0.9375rem; }
code.inline, code.block { background: #0c5749; color: white; font-family: monospace; font-weight: bold; }
code.inline { display: inline-block; padding: 0.5rem 1rem; margin: 0 0.5rem; }
code.block {
  display: block;
  padding: 1rem;
  margin: 1rem auto;
  border-radius: 0.5rem;
  max-width: 40rem;
  line-height: 1rem;
}

.feature-logo {
  margin-bottom: 0.5rem;
  height:        5rem;
  width:         12rem;
  align-self:    center;
}

.tag {
  font-size: 0.8rem;
  background: #f5faf3;
  border: 1px solid #437733;
  color: #437733;
  display: inline-block;
  padding: 0.25rem 0.5rem;
  margin: 0.5rem 0 0;
  align-self: flex-start;
  border-radius: 3px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.spacer {
  flex-grow:  1;
  min-height: 0.5rem;
}

pre, code {
  font-family: monospace;
}

p {
  line-height: 1.5rem;
  margin-top: 0;
  margin-bottom: 0.5rem;
}

svg.icon {
  width: 2rem;
  height: 2rem;
}
a > svg.icon {
  fill: rgb(101, 179, 76);
  width: 1.5rem;
  height: 1.5rem;
  line-height: 1rem;
  vertical-align: baseline;
  margin-right: 0.5rem;
  flex-shrink: 0;
}
.feature a.docs {
  display: flex;
  flex-flow: row nowrap;
  align-items: flex-start;
  font-weight: normal;
  text-decoration: none;
  padding: 0.5rem 0;
  cursor: default;
  color: #888;
}
.feature a.docs[href] {
  text-decoration: underline;
  color: rgb(67, 119, 51);
  cursor: pointer;
}

@keyframes hourglass {
  50%  { transform: rotateZ(0);      }
	100% { transform: rotateZ(180deg); }
}

svg.icon-todo {
  animation-name: hourglass;
  animation-duration: 3s;
  animation-delay: 1s;
  animation-iteration-count: infinite;
}

.links {
  display: flex;
  flex-flow: column nowrap;
}
.links > a {
  margin-right: 1rem;
  transition:
    padding-left 0.33s,
    margin-right 0.33s;
}
.links > a[href]:hover {
  padding-left: 0.5rem;
  margin-right: 0.5rem;
}
.feature pre {
  background: #eee;
  padding: 0.5rem;
  border-radius: 0.1rem;
  font-size: 0.875rem;
  font-weight: normal;
  margin-top: 1rem;
  color: #555;
}

/*.feature .links .icon { fill: #F46623 }*/

.feature.invert { background: rgb(67, 119, 51); color: white; }
.feature.invert * { color: white; fill: white; }
.feature.invert a.docs { color: white; }
.feature.invert a.docs[href] { text-decoration: underline; }

.feature.foss { background: #2e0056; color: white; }
.feature.foss * { color: white; fill:  white; }
.feature.foss a.docs { color: white; }

.icon-todo { fill: #aaa !important; }

#quick-start {
  text-align: center;
  flex-grow: 1;
}

.ensuite-md-rendered {
  background: white;
  display: block;
  max-width: 54rem;
  margin: 0 auto 0 38%;
  padding: 3rem;
  box-shadow: 3px 3px 6px rgba(0,0,0,0.1)
}
.ensuite-md-rendered .table-of-contents {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  width: 38%;
  background: #476d3b;
  background: hsl(106 30% 33% / 1);
  color: white;
  padding: 2rem 0 2rem 1rem;
  border-right: 1px solid #888;
  display: flex;
  justify-content: flex-end;
}
.ensuite-md-rendered h2 { margin-top: 2.5rem; margin-bottom: 0.5rem; }
.ensuite-md-rendered h3 { margin-top: 1.5rem; margin-bottom: 0.5rem; }

ul { margin-left: 0; margin-bottom: 1em; }

p > code { font-weight: bold; color: #345 }
pre > code {
  display: block;
  border: 1px solid #888;
  padding: 0.5rem 1rem;
  margin-bottom: 1rem;
  background: rgba(255,255,255,0.5);
  box-shadow: 2px 2px 2px #888;
  overflow-x: auto;
  margin: 1rem -1rem;
}
pre > code.language-sh {
  background: #123;
  border-radius: 0;
  color: #fe0;
}
pre > code.language-typescript {
  background: #ffe;
  border-radius: 0.15rem;
}

.table-of-contents { overflow: auto }
.table-of-contents a { display: block; color: white; text-decoration: underline 1px dotted black; padding: 0.25rem 1.5rem 0.25rem }
.table-of-contents a:hover { color: black; text-decoration: underline 1px solid rgba(0,0,0,0.75); background: #fff }
.table-of-contents li { margin: 0 0 }
.table-of-contents ul { font-weight: bold; margin-left: 0; list-style: none }
.table-of-contents ul ul { font-weight: normal; margin-left: 1em }
</style>
<content class="ensuite-md-rendered">
<p><div class="table-of-contents"><ul><li><a href="#deployment">Deployment</a><ul><li><a href="#deploying-everything">Deploying everything</a></li><li><a href="#deploying-individual-contracts-and-their-dependencies">Deploying individual contracts and their dependencies</a></li><li><a href="#adding-custom-migrations">Adding custom migrations</a></li><li><a href="#how-state-is-stored">How state is stored</a></li><li><a href="#exporting-the-deployment">Exporting the deployment</a></li><li><a href="#connecting-to-an-exported-deployment">Connecting to an exported deployment</a></li><li><a href="#expecting-contracts-to-be-deployed">Expecting contracts to be deployed</a></li></ul></li><li><a href="#template">Template</a><ul><li><a href="#deploying-multiple-contracts-from-a-template">Deploying multiple contracts from a template</a></li><li><a href="#building">Building</a></li><li><a href="#uploading">Uploading</a></li></ul></li><li><a href="#contract">Contract</a><ul><li><a href="#naming">Naming</a></li><li><a href="#lazy-init">Lazy init</a></li><li><a href="#deploying">Deploying</a></li></ul></li></ul></div></p>
<h1 id="fadroma-guide%3A-deploy-api" tabindex="-1">Fadroma Guide: Deploy API</h1>
<p>The <strong>Deploy API</strong> revolves around the <code>Deployment</code> class, and associated
implementations of <code>Client</code>, <code>Builder</code>, <code>Uploader</code>, and <code>DeployStore</code>.</p>
<p>These classes are used for describing systems consisting of multiple smart contracts,
such as when deploying them from source. By defining such a system as one or more
subclasses of <code>Deployment</code>, Fadroma enables declarative, idempotent, and reproducible
smart contract deployments.</p>
<h2 id="deployment" tabindex="-1">Deployment</h2>
<p>The <code>Deployment</code> class represents a set of interrelated contracts.
To define your deployment, extend the <code>Deployment</code> class, and use the
<code>this.template({...})</code> and <code>this.contract({...})</code> methods to specify
what contracts to deploy:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Deployment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fadroma/agent&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDeployment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Deployment</span> {

  foo = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">contract</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;foo&#x27;</span>,
    <span class="hljs-attr">crate</span>: <span class="hljs-string">&#x27;fadroma-example-kv&#x27;</span>,
    <span class="hljs-attr">initMsg</span>: {}
  })

  bar = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">contract</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;bar&#x27;</span>,
    <span class="hljs-attr">crate</span>: <span class="hljs-string">&#x27;fadroma-example-kv&#x27;</span>,
    <span class="hljs-attr">initMsg</span>: {}
  })

}
</code></pre>
<h3 id="deploying-everything" tabindex="-1">Deploying everything</h3>
<p>To prepare a deployment for deploying, use <code>getDeployment</code>.
This will provide a populated instance of your deployment class.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { getDeployment } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@hackbg/fadroma&#x27;</span>
<span class="hljs-keyword">let</span> deployment = <span class="hljs-title function_">getDeployment</span>(<span class="hljs-title class_">MyDeployment</span>, <span class="hljs-comment">/* ...constructor args */</span>)
</code></pre>
<p>Then, call its <code>deploy</code> method:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">await</span> deployment.<span class="hljs-title function_">deploy</span>()
</code></pre>
<p>For each contract defined in the deployment, this will do the following:</p>
<ul>
<li>If it's not compiled yet, this will <strong>build</strong> it.</li>
<li>If it's not uploaded yet, it will <strong>upload</strong> it.</li>
<li>If it's not instantiated yet, it will <strong>instantiate</strong> it.</li>
</ul>
<p>Having deployed a contract, you want to obtain a <code>Client</code> instance
that points to it, so you can call the contract's methods.</p>
<p>There are two ways of doing this, awaiting and expecting.</p>
<h3 id="deploying-individual-contracts-and-their-dependencies" tabindex="-1">Deploying individual contracts and their dependencies</h3>
<p>By <code>await</code>ing a <code>Contract</code>'s <code>deployed</code> property, you say:
&quot;give me a handle to this contract; if it's not deployed,
deploy it, and all of its dependencies (as specified by the <code>initMsg</code> method)&quot;.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> foo1 = <span class="hljs-keyword">await</span> deployment.<span class="hljs-property">foo</span>.<span class="hljs-property">deployed</span>
<span class="hljs-keyword">const</span> bar1 = <span class="hljs-keyword">await</span> deployment.<span class="hljs-property">bar</span>.<span class="hljs-property">deployed</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Client</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fadroma/agent&#x27;</span>
<span class="hljs-title function_">assert</span>(foo1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
<span class="hljs-title function_">assert</span>(bar1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
</code></pre>
<p>Since this does not call the deployment's <code>deploy</code> method,
it <em>only</em> deploys the requested contract and its dependencies
but not any other contracts defined in the deployment.</p>
<h3 id="adding-custom-migrations" tabindex="-1">Adding custom migrations</h3>
<p>The default <code>Deployment#deploy</code> method simply instantiates all
contracts defined using the <code>Deployment#contract</code> method. To
implement a custom deploy order, you can override <code>deploy</code>.</p>
<p>Let's build on top of the first example and implement
a custom <code>deploy</code> method:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDeployment2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MyDeployment</span> {

  <span class="hljs-keyword">async</span> deploy (deployOnlyFoo?: <span class="hljs-built_in">boolean</span>) {
    <span class="hljs-comment">/** You can override the deploy method to deploy with custom logic. */</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">foo</span>.<span class="hljs-property">deployed</span>
    <span class="hljs-keyword">if</span> (!deployOnlyFoo) <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bar</span>.<span class="hljs-property">deployed</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>
  }

  <span class="hljs-keyword">async</span> update (<span class="hljs-attr">previous</span>: <span class="hljs-title class_">Deployment</span>) {
    <span class="hljs-comment">/** Here you may implement an upgrade method that fetches
      * the state of existing contracts, and deploys new ones. */</span>
  }

}

<span class="hljs-keyword">const</span> deployment2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDeployment</span>(<span class="hljs-title class_">MyDeployment2</span>).<span class="hljs-title function_">deploy</span>()

<span class="hljs-title function_">assert</span>(deployment2.<span class="hljs-property">foo</span>.<span class="hljs-title function_">expect</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
<span class="hljs-title function_">assert</span>(deployment2.<span class="hljs-property">bar</span>.<span class="hljs-title function_">expect</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
</code></pre>
<h3 id="how-state-is-stored" tabindex="-1">How state is stored</h3>
<p>See the <code>DeployStore</code> implementation.</p>
<h3 id="exporting-the-deployment" tabindex="-1">Exporting the deployment</h3>
<p>This feature is a work-in-progress.</p>
<h3 id="connecting-to-an-exported-deployment" tabindex="-1">Connecting to an exported deployment</h3>
<p>Having been deployed once, contracts may be used continously.
The <code>Deployment</code>'s <code>connect</code> method loads stored data about
the contracts in the deployment, populating the contained
<code>Contract</code> instances.</p>
<h3 id="expecting-contracts-to-be-deployed" tabindex="-1">Expecting contracts to be deployed</h3>
<p>Using the <code>expect</code> method, you state: &quot;I expect that
at the current point in time, this contract is deployed;
now, give me a handle to it&quot;.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> foo2 = deployment.<span class="hljs-property">foo</span>.<span class="hljs-title function_">expect</span>()
<span class="hljs-keyword">const</span> bar2 = deployment.<span class="hljs-property">bar</span>.<span class="hljs-title function_">expect</span>()

<span class="hljs-title function_">assert</span>(foo2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
<span class="hljs-title function_">assert</span>(bar2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
</code></pre>
<p>If the address of the request contract is not available,
this will throw an error.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> assert <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;node:assert&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./Deploy.test.ts&#x27;</span>
</code></pre>
<h2 id="template" tabindex="-1">Template</h2>
<p>The <code>Contract</code> class describes a smart contract's source, binary, and upload.</p>
<h3 id="deploying-multiple-contracts-from-a-template" tabindex="-1">Deploying multiple contracts from a template</h3>
<p>The <code>Deployment#template</code> method allows you to add a <code>Template</code>
in the <code>Deployment</code>. A <code>Template</code> can be built and uploaded,
and then create multiple <code>Contract</code> instances that use to the same code,
via the <code>Template#instance</code> method.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDeployment3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MyDeployment</span> {

  baz = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">template</span>({ <span class="hljs-attr">crate</span>: <span class="hljs-string">&#x27;fadroma-example-kv&#x27;</span> })

  baz1 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baz</span>.<span class="hljs-title function_">instance</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;baz1&#x27;</span>, <span class="hljs-attr">initMsg</span>: {} })

  bazN = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baz</span>.<span class="hljs-title function_">instances</span>([
    { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;baz2&#x27;</span>, <span class="hljs-attr">initMsg</span>: {} },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;baz3&#x27;</span>, <span class="hljs-attr">initMsg</span>: {} },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;baz4&#x27;</span>, <span class="hljs-attr">initMsg</span>: {} }
  ])

}

<span class="hljs-keyword">const</span> deployment3 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDeployment</span>(<span class="hljs-title class_">MyDeployment3</span>).<span class="hljs-title function_">deploy</span>()

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Contract</span>, <span class="hljs-title class_">Template</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fadroma/agent&#x27;</span>

<span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">foo</span>.<span class="hljs-title function_">expect</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
<span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">bar</span>.<span class="hljs-title function_">expect</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)

<span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">baz</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Template</span>)

<span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">baz1</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Contract</span>)
<span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-title function_">expect</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Client</span>)
</code></pre>
<p>To deploy multiple contract instances from the same code,
you can use templates.</p>
<p>You can pass either an array or an object to <code>template.instances</code>:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> [ templateInsanceThree, templateClientFour ] = <span class="hljs-keyword">await</span> template.<span class="hljs-title function_">instances</span>([
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;name3&#x27;</span>, <span class="hljs-attr">initMsg</span>: { <span class="hljs-attr">parameter</span>: <span class="hljs-string">&#x27;value3&#x27;</span> } },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;name4&#x27;</span>, <span class="hljs-attr">initMsg</span>: { <span class="hljs-attr">parameter</span>: <span class="hljs-string">&#x27;value4&#x27;</span> } },
])
<span class="hljs-keyword">const</span> { templateClientFoo, templateClientBar } = <span class="hljs-keyword">await</span> template.<span class="hljs-title function_">instances</span>({
  <span class="hljs-attr">templateClientFoo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;name5&#x27;</span>, <span class="hljs-attr">initMsg</span>: { <span class="hljs-attr">parameter</span>: <span class="hljs-string">&#x27;value5&#x27;</span> } },
  <span class="hljs-attr">templateClientFoo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;name6&#x27;</span>, <span class="hljs-attr">initMsg</span>: { <span class="hljs-attr">parameter</span>: <span class="hljs-string">&#x27;value6&#x27;</span> } },
})
</code></pre>
<h3 id="building" tabindex="-1">Building</h3>
<pre><code class="hljs language-typescript"><span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">builder</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Builder</span>) <span class="hljs-comment">// required to build</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz</span>.<span class="hljs-property">built</span> <span class="hljs-comment">// with defaults</span>
<span class="hljs-comment">// -or-</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz</span>.<span class="hljs-title function_">build</span>() <span class="hljs-comment">// always builds</span>
</code></pre>
<h3 id="uploading" tabindex="-1">Uploading</h3>
<pre><code class="hljs language-typescript"><span class="hljs-title function_">assert</span>(deployment3.<span class="hljs-property">uploader</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Uploader</span>) <span class="hljs-comment">// required to upload</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz</span>.<span class="hljs-property">uploaded</span> <span class="hljs-comment">// with defaults</span>
<span class="hljs-comment">// -or-</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz</span>.<span class="hljs-title function_">upload</span>() <span class="hljs-comment">// always builds</span>
</code></pre>
<p>If the contract binary is not found, uploading will try to build it first.</p>
<h2 id="contract" tabindex="-1">Contract</h2>
<p>The <code>Contract</code> class describes an individual smart contract instance and uniquely identifies it
within the <code>Deployment</code>.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Contract</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@fadroma/agent&#x27;</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contract</span>({
  <span class="hljs-attr">repository</span>: <span class="hljs-string">&#x27;REPO&#x27;</span>,
  <span class="hljs-attr">revision</span>:   <span class="hljs-string">&#x27;REF&#x27;</span>,
  <span class="hljs-attr">workspace</span>:  <span class="hljs-string">&#x27;WORKSPACE&#x27;</span>
  <span class="hljs-attr">crate</span>:      <span class="hljs-string">&#x27;CRATE&#x27;</span>,
  <span class="hljs-attr">artifact</span>:   <span class="hljs-string">&#x27;ARTIFACT&#x27;</span>,
  <span class="hljs-attr">chain</span>:      { <span class="hljs-comment">/* ... */</span> },
  <span class="hljs-attr">agent</span>:      { <span class="hljs-comment">/* ... */</span> },
  <span class="hljs-attr">deployment</span>: { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-attr">codeId</span>:     <span class="hljs-number">0</span>,
  <span class="hljs-attr">codeHash</span>:   <span class="hljs-string">&#x27;CODEHASH&#x27;</span>
  <span class="hljs-attr">client</span>:     <span class="hljs-title class_">Client</span>,
  <span class="hljs-attr">name</span>:       <span class="hljs-string">&#x27;NAME&#x27;</span>,
  <span class="hljs-attr">initMsg</span>:    <span class="hljs-keyword">async</span> () =&gt; ({})
})
</code></pre>
<h3 id="naming" tabindex="-1">Naming</h3>
<p>The chain requires labels to be unique.
Labels generated by Fadroma are of the format <code>[DeploymentName]/[ContractName]</code>.</p>
<h3 id="lazy-init" tabindex="-1">Lazy init</h3>
<p>The <code>initMsg</code> property of <code>Contract</code> can be a function returning the actual message.
This function is only called during instantiation, and can be used to generate init
messages on the fly, such as when passing the address of one contract to another.</p>
<h3 id="deploying" tabindex="-1">Deploying</h3>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-title function_">deploy</span>()
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-property">deployed</span>

<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-property">uploaded</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-title function_">upload</span>()

<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-property">built</span>
<span class="hljs-keyword">await</span> deployment3.<span class="hljs-property">baz1</span>.<span class="hljs-title function_">build</span>()
</code></pre>

</content>
</body>
</html>