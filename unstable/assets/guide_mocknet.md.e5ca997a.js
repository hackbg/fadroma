import{_ as s,c as n,o as a,a as e}from"./app.66afa4f2.js";const m=JSON.parse('{"title":"Fast full-stack testing of production builds with Fadroma Mocknet","description":"","frontmatter":{},"headers":[{"level":2,"title":"Enable mocknet","slug":"enable-mocknet"},{"level":2,"title":"Example: mocknet-only test command","slug":"example-mocknet-only-test-command"}],"relativePath":"guide/mocknet.md","lastUpdated":1658115337000}'),o={name:"guide/mocknet.md"},t=e(`<h1 id="fast-full-stack-testing-of-production-builds-with-fadroma-mocknet" tabindex="-1">Fast full-stack testing of production builds with Fadroma Mocknet <a class="header-anchor" href="#fast-full-stack-testing-of-production-builds-with-fadroma-mocknet" aria-hidden="true">#</a></h1><p>Testing the production builds of smart contracts, and the associated client classes and deploy scripts, can be slow and awkward. Testnets are permanent and public; devnets can be temporary, but transactions are still throttled by the rate at which blocks are processed.</p><p>Smart contracts are just WASM programs. They are written with the expectation that they will be run by the CosmWasm blockchain&#39;s WASM runtime (<code>compute</code> module), but WASM itself is a portable, environment-independent format, and Node.js has native support for running WASM modules.</p><p>From this, it follows that by providing implementations of the contract-facing CosmWasm API, we could run the production builds of smart contracts inside a simulated blockchain-like environment.</p><p>Such an environment would not be bound to the distrubuted consensus mechanisms of a blockchan, and would thus allow the contracts to be tested more quickly. This is especially useful in CI environments, where launching a devnet container might not be possible or desirable.</p><h2 id="enable-mocknet" tabindex="-1">Enable mocknet <a class="header-anchor" href="#enable-mocknet" aria-hidden="true">#</a></h2><p>The easiest way to use Mocknet is to set <code>FADROMA_CHAIN=Mocknet</code> in your environment, and run your deploy scripts as usual. They should work just the same - only way faster.</p><h2 id="example-mocknet-only-test-command" tabindex="-1">Example: mocknet-only test command <a class="header-anchor" href="#example-mocknet-only-test-command" aria-hidden="true">#</a></h2><p>Continuing our Fadroma Ops example from the previous chapter, let&#39;s add a <code>test</code> command which only ever runs on Mocknet.</p><div class="language-typescript"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> assert </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">assert</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Fadroma</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FADROMA_CHAIN</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Mocknet</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">common</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  Fadroma</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Deploy</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">New</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  deployMyContract</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  configureMyContract</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">testMyContract</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">myContract</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">q2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">some expected value</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>The extra step before <code>...common</code> modifies the environment of the running Node process. The subsequent <code>Fadroma.Chain.FromEnv</code> step contained in <code>common</code> will populate the context with an instance of <code>Mocknet</code> instead of the chain that would otherwise be used.</p>`,11),l=[t];function p(c,r,i,d,y,D){return a(),n("div",null,l)}var u=s(o,[["render",p]]);export{m as __pageData,u as default};
